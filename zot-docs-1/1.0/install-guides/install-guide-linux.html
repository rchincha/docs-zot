<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Installation Guide for Bare Metal Linux :: Zot Docs</title>
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">Zot Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="zot-docs-1" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../toc/zot-toc.html">Zot Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../toc/zot-toc.html">Documentation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../concepts/zot-concepts.html">Concepts</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installation Guides</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="install-guide-linux.html">Installation Guide for Bare Metal Linux</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../admin-guide/admin-guide.html">Zot Administrator Guide</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../developer-guide/draft-developer-guide-chapters.html">Zot Developer Guide</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Zot Documentation</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../toc/zot-toc.html">Zot Documentation</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../toc/zot-toc.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../toc/zot-toc.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../toc/zot-toc.html">Zot Documentation</a></li>
    <li>Installation Guides</li>
    <li><a href="install-guide-linux.html">Installation Guide for Bare Metal Linux</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/project-zot/docs-zot/edit/main/modules/install-guides/pages/install-guide-linux.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Installation Guide for Bare Metal Linux</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Revised: 2022-08-09</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_before_you_begin"><a class="anchor" href="#_before_you_begin"></a><a class="link" href="#_before_you_begin">Before you begin</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_supported_platforms"><a class="anchor" href="#_supported_platforms"></a><a class="link" href="#_supported_platforms">Supported platforms</a></h3>
<div class="paragraph">
<p>You can install zot on standard Linux platforms with
Intel or ARM processors and with systemd installed.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 1. Supported platforms and architectures</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">OS</th>
<th class="tableblock halign-left valign-top">ARCH</th>
<th class="tableblock halign-left valign-top">Platform</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">linux</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">amd64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel-based Linux servers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">linux</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">arm64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARM-based servers and Raspberry Pi4</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_full_and_minimal_binary_images"><a class="anchor" href="#_full_and_minimal_binary_images"></a><a class="link" href="#_full_and_minimal_binary_images">Full and minimal binary images</a></h3>
<div class="paragraph">
<p>In addition to variations for specific platforms and architectures, binary images
are also available in full and minimal implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A full zot binary image is compiled with all extensions. Extensions
include functions such as metrics, registry synchronization, search, and scrub.</p>
</li>
<li>
<p>A minimal distribution-spec conformant zot binary image is compiled with
only a minimal set of code and libraries, reducing the attack surface. This
option might be optimal for a registry embedded in a shipping product.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_binary_image_file_naming"><a class="anchor" href="#_binary_image_file_naming"></a><a class="link" href="#_binary_image_file_naming">Binary image file naming</a></h3>
<div class="paragraph">
<p>An executable binary image for zot is named using the target platform and
architecture from the
 <a href="#supported-platforms-zot">Supported platforms and architectures</a>
 table. The general format of a binary image file name is one of these two:</p>
</div>
<div class="paragraph">
<p><code>zot-<em>os</em>-<em>architecture</em></code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>A full zot binary image with all extensions has a filename of the
form <code>zot-<em>os</em>-<em>architecture</em>.</code> For example, the full binary image for an
Intel-based linux server is <code>zot-linux-amd64</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>zot-<em>os</em>-<em>architecture</em>-minimal</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>A minimal distribution-spec conformant zot binary image has a filename of
the form <code>zot-<em>os</em>-<em>architecture</em>-minimal</code>. For example, the minimal binary
image for an Intel-based linux server is <code>zot-linux-amd64-minimal</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation"><a class="anchor" href="#_installation"></a><a class="link" href="#_installation">Installation</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_step_1_get_zot"><a class="anchor" href="#_step_1_get_zot"></a><a class="link" href="#_step_1_get_zot">Step 1: Get zot</a></h3>
<div class="paragraph">
<p>Using <code>wget,</code> download the appropriate zot binary image for your platform from the
<a href="https://github.com/project-zot/zot/releases">zot GitHub project</a>. Download the image
to the`/usr/bin/` directory and rename it to <code>zot,</code> as in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ wget -O /usr/bin/zot  https://github.com/project-zot/zot/releases/download/v1.4.2-rc2/zot-linux-amd64</pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">MIKE&#8217;S QUESTIONS</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Do we need to rename the binary or to chmod it to be executable?</p>
</li>
<li>
<p>What does -N do?</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_create_a_zot_configuration_file"><a class="anchor" href="#_step_2_create_a_zot_configuration_file"></a><a class="link" href="#_step_2_create_a_zot_configuration_file">Step 2: Create a zot configuration file</a></h3>
<div class="paragraph">
<p>Create a zot configuration file as <code>/etc/zot/config.json</code>.</p>
</div>
<div class="paragraph">
<p>See <a href="#config_file">Configuration file options</a> for an example file with
options and recommendations. You can find other configuration file
<a href="https://github.com/project-zot/zot/tree/main/examples">examples</a> in
the zot GitHub project and in the <em>Zot Administrator Guide</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_configure_a_local_authentication_account"><a class="anchor" href="#_step_3_configure_a_local_authentication_account"></a><a class="link" href="#_step_3_configure_a_local_authentication_account">Step 3: Configure a local authentication account</a></h3>
<div class="paragraph">
<p>If you want to use local authentication with zot, create a <code>/etc/zot/htpasswd</code>
file with an initial account entry using the <code>htpasswd</code> command as in this
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ htpasswd -bnB myUserName myPassword &gt; /etc/zot/htpasswd</pre>
</div>
</div>
<div class="paragraph">
<p>To add additional local users, use the <code>&gt;&gt;</code> redirect as in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ htpasswd -bnB myUserName2 myPassword2 &gt;&gt; /etc/zot/htpasswd</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_4_define_the_zot_service"><a class="anchor" href="#_step_4_define_the_zot_service"></a><a class="link" href="#_step_4_define_the_zot_service">Step 4: Define the zot service</a></h3>
<div class="paragraph">
<p>Create a <code>/etc/systemd/system/zot.service</code> file to define the zot service
in systemd.  The following is an example service file for zot:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Unit]
Description=OCI Distribution Registry
Documentation=https://zotregistry.io/
After=network.target auditd.service local-fs.target

[Service]
Type=simple
ExecStart=/usr/bin/zot serve /etc/zot/config.json
Restart=on-failure
User=zot
Group=zot
LimitNOFILE=500000
MemoryHigh=30G
MemoryMax=32G

[Install]
WantedBy=multi-user.target</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Be sure to configure a dedicated non-root user ID as the User and Group in
the zot service definition. The 'zot' user ID in this example is created in the
next step.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_step_5_create_a_user_id_to_own_the_zot_service"><a class="anchor" href="#_step_5_create_a_user_id_to_own_the_zot_service"></a><a class="link" href="#_step_5_create_a_user_id_to_own_the_zot_service">Step 5: Create a user ID to own the zot service</a></h3>
<div class="paragraph">
<p>Create a non-root user ID to be the owner of the zot service and its resources.</p>
</div>
<div class="paragraph">
<p>In this example, the user ID 'zot' is created with the <code>adduser</code> command, and
resource ownership is assigned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ sudo adduser --no-create-home --disabled-password --gecos --disabled-login zot

$ sudo mkdir -p /data/zot
$ sudo chown -R zot:zot /data/zot

$ sudo mkdir -p /var/log/zot
$ sudo chown -R zot:zot /var/log/zot

$ sudo chown root:root /usr/bin/zot
$ sudo chown root:root config.json</pre>
</div>
</div>
<div class="paragraph">
<p>With the <code>adduser</code> options shown, the 'zot' user ID has no local directory.
There is no ability to log into the zot user account, and the account has
no finger information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_step_6_start_zot"><a class="anchor" href="#_step_6_start_zot"></a><a class="link" href="#_step_6_start_zot">Step 6: Start zot</a></h3>
<div class="paragraph">
<p>Enable and start the zot service with these commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ sudo systemctl enable zot
$ sudo systemctl start zot</pre>
</div>
</div>
<div class="paragraph">
<p>When the zot service has started, you can check its status with this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ sudo systemctl status zot</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_after_the_installation"><a class="anchor" href="#_after_the_installation"></a><a class="link" href="#_after_the_installation">After the installation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If your zot registry server is public facing, we recommend that you test
your TLS configuration using a service such as
the <a href="https://www.ssllabs.com/ssltest/">Qualys SSL Server Test</a>.</p>
</div>
<div class="paragraph">
<p>Refer to the <em>Zot Administrator Guide</em> for further information about maintaining your
zot registry server.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="config_file"><a class="anchor" href="#config_file"></a><a class="link" href="#config_file">Configuration file options and recommendations</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following zot configuration file (<code>config.json</code>) can be used as a template
for your own installation. You can modify this file to suit your own environment.</p>
</div>
<div class="paragraph">
<p>Refer to the <em>Zot Administrator Guide</em> for more details about configuration file
options.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "distSpecVersion":"1.0.1",
  "storage":{
    "dedupe": true,
    "gc": true,
    "gcDelay": "1h",
    "gcInterval": "6h",
    "rootDirectory":"/data/zot/"
  },
  "http": {
    "address":"0.0.0.0",
    "port":"443",
    "realm":"zot",
    "tls": {
      "cert": "/etc/letsencrypt/live/zothub.io/fullchain.pem",
      "key": "/etc/letsencrypt/live/zothub.io/privkey.pem"
    },
    "auth": {
      "htpasswd": {
        "path": "/etc/zot/htpasswd"
      },
      "failDelay": 5
    },
    "allowReadAccess": true
  },
  "log":{
    "level":"debug",
    "output":"/var/log/zot/zot.log",
    "audit":"/var/log/zot/zot-audit.log"
  },
  "extensions": {
    "search": {
      "enable": true,
      "cve": {
        "updateInterval": "24h"
      }
    },
    "sync": {
      "enable": false,
      "registries": [
        {
          "urls": ["https://mirror.gcr.io/library"],
          "onDemand": true,
          "maxRetries": 3,
          "retryDelay": "5m",
          "pollInterval": "6h"
        },
        {
          "urls": ["https://docker.io/library"],
          "onDemand": true
        }
      ]
    },
    "scrub": {
      "interval": "24h"
    }
  }
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_tls_encryption"><a class="anchor" href="#_tls_encryption"></a><a class="link" href="#_tls_encryption">TLS encryption</a></h3>
<div class="paragraph">
<p>We recommend using a certificate authority such as
<a href="https://letsencrypt.org/">Let&#8217;s Encrypt</a> that offers TLS encryption, as
shown in this configuration example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"tls": {
  "cert": "/etc/letsencrypt/live/zothub.io/fullchain.pem",
  "key": "/etc/letsencrypt/live/zothub.io/privkey.pem"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_registry_synchronization"><a class="anchor" href="#_registry_synchronization"></a><a class="link" href="#_registry_synchronization">Registry synchronization</a></h3>
<div class="paragraph">
<p>The example file enables registry synchronization with two other container
registries. In the example, the zot server synchronizes with the Google
and Docker container registries, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"sync": {
  "enable": false,
  "registries": [
    {
      "urls": ["https://mirror.gcr.io/library"],
      "onDemand": true,
      "maxRetries": 3,
      "retryDelay": "5m",
      "pollInterval": "6h"
    },
    {
      "urls": ["https://docker.io/library"],
      "onDemand": true
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
